<template>
  <div class="flex flex-col lg:flex-row gap-4 items-start">
    <StepSidebar
      class="lg:sticky lg:top-6 flex-shrink-0"
      :sections="stepSections"
      current-key="step3-goals"
      title="STEP 3"
    />

    <div class="bg-[#f5fbff] border-4 border-black rounded-[28px] p-5 flex-1 space-y-5">
      <header class="text-center space-y-1">
        <div class="text-[28px] font-extrabold leading-tight">
          ‡∏à‡∏±‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
        </div>
        <p class="text-sm text-slate-600">‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</p>
      </header>

      <section class="grid gap-5 md:grid-cols-2">
        <article
          v-for="card in goalCards"
          :key="card.key"
          class="rounded-[32px] border-4 border-black bg-white p-4 flex flex-col gap-3"
        >
          <header class="inline-flex rounded-2xl border-2 border-black bg-[#fff2b8] px-4 py-1 text-sm font-bold justify-center">
            {{ card.title }}
          </header>
          <textarea
            v-model="card.value"
            class="min-h-[220px] rounded-2xl border-2 border-black px-3 py-2 text-sm bg-white"
            placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢..."
          ></textarea>
          <button
            type="button"
            class="inline-flex items-center justify-center rounded-2xl border-2 border-black bg-[#eafaf3] px-3 py-2 text-sm font-semibold"
            @click="openFilePicker(card.key)"
          >
            üìé ‡∏Ñ‡∏•‡∏¥‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå
          </button>
          <ul v-if="card.files.length" class="text-xs text-slate-500 pl-3 space-y-1">
            <li v-for="name in card.files" :key="name">‚Ä¢ {{ name }}</li>
          </ul>
        </article>
      </section>

      <div class="rounded-2xl border-4 border-black bg-white p-4 space-y-2 text-sm">
        <p class="text-slate-600">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏µ‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
        <ul class="text-xs text-slate-500 list-disc pl-5">
          <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞ PDF ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</li>
          <li>‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ</li>
        </ul>
      </div>

      <div class="flex flex-wrap gap-3 justify-end">
        <button class="action-btn bg-white" @click="goBack">¬´ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="action-btn bg-white" @click="saveGoals">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="action-btn bg-[#d9fbe7]" @click="goNext">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ¬ª</button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { reactive } from 'vue'
import { useRouter } from 'vue-router'
import StepSidebar from '@/components/StepSidebar.vue'
import { STEP1_AND_2_SIDEBAR } from '@/constants/qccSteps'

const router = useRouter()
const stepSections = STEP1_AND_2_SIDEBAR

const goalCards = reactive([
  { key: 'individual', title: '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', value: '', files: [] },
  { key: 'team', title: '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°', value: '', files: [] },
])

function openFilePicker(key) {
  const input = document.createElement('input')
  input.type = 'file'
  input.multiple = true
  input.accept = '.pdf,image/*'
  input.onchange = event => {
    const files = Array.from(event.target.files || [])
    const card = goalCards.find(item => item.key === key)
    if (card) {
      card.files = files.map(file => file.name)
    }
  }
  input.click()
}

function saveGoals() {
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)')
}

function goNext() {
  router.push('/step3/plan')
}

function goBack() {
  router.push('/summary-step3')
}
</script>

<style scoped>
@reference "tailwindcss";

.action-btn {
  @apply rounded-2xl border-2 border-black px-4 py-2 text-sm font-semibold shadow hover:-translate-y-0.5 transition;
}
</style>
